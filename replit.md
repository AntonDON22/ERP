# Система управления продуктами (ERP)

## Обзор

Это полнофункциональное веб-приложение для управления продуктами с современным React фронтендом и Express.js бекендом. Система позволяет пользователям создавать, читать, обновлять и удалять продукты с детальной информацией, включая изображения, цены и размеры.

## Архитектура системы

### Архитектура фронтенда
- **Фреймворк**: React 18 с TypeScript
- **Стилизация**: Tailwind CSS с библиотекой компонентов shadcn/ui
- **Управление состоянием**: TanStack Query (React Query) для серверного состояния
- **Маршрутизация**: Wouter для клиентской маршрутизации
- **Обработка форм**: React Hook Form с валидацией Zod
- **Инструмент сборки**: Vite для разработки и производственных сборок

### Архитектура бекенда
- **Фреймворк**: Express.js с TypeScript
- **База данных**: PostgreSQL с Drizzle ORM
- **Хранение файлов**: Локальная файловая система с multer для загрузки изображений
- **Управление сессиями**: Express сессии с хранением в PostgreSQL
- **Разработка**: Горячая перезагрузка с интеграцией Vite

## Ключевые компоненты

### Схема базы данных
- **Таблица пользователей**: Базовая аутентификация пользователей (id, username, password)
- **Таблица продуктов**: Комплексная информация о продуктах включающая:
  - Базовая информация (name, sku)
  - Ценообразование (price, purchase_price)
  - Физические атрибуты (weight, dimensions)
  - Медиа (image_url, barcode)

### API Endpoints
- `GET /api/products` - Получить все продукты
- `GET /api/products/:id` - Получить один продукт
- `POST /api/products` - Создать новый продукт с загрузкой изображения
- `PUT /api/products/:id` - Обновить существующий продукт
- `DELETE /api/products/:id` - Удалить продукт
- `GET /uploads/*` - Служить загруженным изображениям

### Страницы фронтенда
- **ProductsList**: Основной список продуктов с поиском, фильтрацией и сортировкой
- **AddProduct**: Форма для создания новых продуктов с загрузкой изображений
- **EditProduct**: Форма для обновления существующих продуктов
- **ProductDetail**: Детальный просмотр отдельных продуктов
- **NotFound**: Страница ошибки 404

### Стратегия хранения
Приложение использует двойной подход к хранению:
- **Разработка**: Хранение в памяти для быстрой разработки и тестирования
- **Продакшн**: База данных PostgreSQL с Drizzle ORM для постоянства

## Поток данных

1. **Создание продукта**: Пользователь отправляет форму → Фронтенд проверяет с Zod → FormData отправляется на бекенд → Изображение сохраняется на диск → Данные продукта сохраняются в БД
2. **Список продуктов**: Фронтенд запрашивает продукты → Бекенд получает из хранилища → Данные преобразуются и возвращаются → Фронтенд отображает с кешированием React Query
3. **Обработка изображений**: Изображения загружаются в каталог `/uploads` → Статично обслуживаются Express → Ссылаются по URL в базе данных

## Внешние зависимости

### Основные зависимости
- **@neondatabase/serverless**: Подключение к базе данных PostgreSQL
- **drizzle-orm**: Типобезопасная ORM для базы данных
- **@tanstack/react-query**: Управление серверным состоянием
- **react-hook-form**: Обработка форм и валидация
- **zod**: Валидация схемы
- **multer**: Обработка загрузки файлов

### UI зависимости
- **@radix-ui/***: Доступные UI примитивы
- **tailwindcss**: Utility-first CSS фреймворк
- **lucide-react**: Библиотека иконок
- **class-variance-authority**: Управление вариантами компонентов

## Стратегия развертывания

### Разработка
- Фронтенд: Vite dev сервер с HMR
- Бекенд: tsx с горячей перезагрузкой
- База данных: Может использовать хранение в памяти или PostgreSQL

### Продакшн
- Фронтенд: Статическая сборка обслуживается Express
- Бекенд: Скомпилирован в ESM пакет с esbuild
- База данных: PostgreSQL с миграциями через Drizzle Kit
- Хранение файлов: Локальный каталог uploads

### Процесс сборки
1. `npm run build` - Компилирует фронтенд в статические файлы и бекенд в продакшн пакет
2. `npm run start` - Запускает продакшн сервер
3. `npm run db:push` - Применяет изменения схемы базы данных

## История изменений
- 30 июня 2025. Первоначальная настройка: Создание базовой структуры проекта
- 30 июня 2025. Удалены поля категории и описания: Полностью убраны из всех продуктов
- 30 июня 2025. Миграция на PostgreSQL: Успешный переход с хранения в памяти на базу данных PostgreSQL с Drizzle ORM
- 30 июня 2025. Упрощение до просмотра товаров: Удалены все фото, кнопки и функциональность создания/редактирования
- 30 июня 2025. Добавлен поиск: Реализован поиск по названию, SKU и штрих-коду с фильтрацией в реальном времени
- 30 июня 2025. Изменение размера столбцов: Реализовано изменение ширины столбцов с сохранением в localStorage
- 30 июня 2025. Множественное удаление: Добавлен выбор продуктов с чекбоксами и функциональность массового удаления
- 30 июня 2025. Очистка кодовой базы: Удалены неиспользуемые страницы и ненужные маршруты backend
- 30 июня 2025. Поддержка касания на мобильных: Добавлена поддержка касания для изменения размера столбцов на iPhone
- 30 июня 2025. Страница поставщиков: Создана страница "Поставщики" копированием структуры страницы продуктов
- 30 июня 2025. Навигация с wouter: Реализована маршрутизация для навигации между вкладками "Товары" и "Поставщики"
- 30 июня 2025. Изменение заголовка: Заголовок столбца с "Наименование" на "Название" в таблице продуктов
- 30 июня 2025. Упрощение таблицы поставщиков: Показываются только столбцы "Название" и "Вебсайт"
- 30 июня 2025. Таблица поставщиков в PostgreSQL: Создана с полями название и вебсайт
- 30 июня 2025. Обновление статистики поставщиков: Формат изменен на "Всего поставщиков" вместо "Показано X из Y"
- 30 июня 2025. Исправление прыжков UI: Удалена функциональность изменения размера столбцов, таблицы стали статичными
- 30 июня 2025. Многострочный текст: Реализован перенос длинных названий продуктов и поставщиков (лимит 2 строки)
- 30 июня 2025. Главная страница Dashboard: Создана с полной историей изменений системы с датами, временем и описаниями
- 30 июня 2025. Упрощение Dashboard: Показывается только история изменений, удалены блоки обзора системы
- 30 июня 2025. Модуль контрагентов: Создана страница "Контрагенты" с полным поиском, выбором и удалением
- 30 июня 2025. Унификация модулей: Страница контрагентов сделана идентичной поставщикам, все три модуля имеют одинаковый дизайн
- 30 июня 2025. Тестовые данные контрагентов: Добавлены 3 тестовых контрагента, проверена функциональность Excel экспорта
- 30 июня 2025. Рефакторинг кода: Создан универсальный компонент DataTable, сокращена кодовая база на 50%
- 30 июня 2025. Импорт Excel для продуктов: Решены проблемы импорта, реализована система очистки данных
- 30 июня 2025. Полная функциональность Excel: Импорт/экспорт с возможностью обновления для всех трех модулей
- 30 июня 2025. Исправление удаления: Исправлены названия полей API запросов для корректной работы удаления
- 30 июня 2025. Улучшение форматирования чисел: Удален суффикс ".0" для целых чисел в полях веса и размеров
- 30 июня 2025. Модуль документов: Создан четвертый модуль системы для управления документами
- 30 июня 2025. Поле даты в документах: Добавлен столбец даты в таблицу документов
- 30 июня 2025. Удаление Excel экспорта из документов: Полностью убрана функциональность экспорта для модуля документов
- 30 июня 2025. Стандартизация названий кнопок: Изменены названия кнопок на простые формы во всех модулях
- 30 июня 2025. Кнопка создания документов: Добавлена кнопка "Создать" в модуль документов
- 30 июня 2025. Универсальный компонент документа: Создан настраиваемый интерфейс создания документов
- 30 июня 2025. CRUD функциональность документов: Добавлена поддержка трех режимов (создание, редактирование, просмотр)
- 30 июня 2025. Защита от дублирования документов: Переписана логика создания документов для предотвращения дубликатов
- 30 июня 2025. Кликабельные строки таблицы: Добавлена возможность редактирования документов по клику на строку
- 30 июня 2025. Улучшение UI документов: Упрощены заголовки страниц и стандартизированы названия
- 30 июня 2025. Исправление логики кнопок: Устранено дублирование кнопок "Отменить/Отмена"
- 30 июня 2025. Автоматическое именование документов: Удалено поле даты, документы автогенерируют названия
- 30 июня 2025. Оптимизация полей документа: Переработана сетка полей документа с максимальным пространством для названий
- 30 июня 2025. Модуль остатков: Создан пятый модуль системы для отображения остатков товаров
- 30 июня 2025. Исправление отслеживания остатков: Приходные документы теперь правильно обновляют уровни остатков
- 30 июня 2025. Очистка тестовых данных: Удалены накопленные тестовые документы и записи остатков
- 30 июня 2025. Исправление удаления документов: Реализовано каскадное удаление связанных записей
- 30 июня 2025. Исправление логики FIFO: Документы "Списание" теперь корректно вычитают количества остатков
- 30 июня 2025. Полная система FIFO: Реализован метод processWriteoffFIFO для обработки списаний по принципу "первый пришел - первый ушел"
- 30 июня 2025. Мобильная навигация: Заменены горизонтальные вкладки на меню-гамбургер для мобильных устройств
- 30 июня 2025. Оптимизация базы данных: Добавлены внешние ключи для целостности данных и индексы производительности
- 30 июня 2025. Интерактивная история изменений: Переработана страница Dashboard с группировкой по дням
- 1 июля 2025. Скрытие секций по умолчанию: Изменено начальное состояние секций - теперь они закрыты, пользователи кликают для расширения и просмотра обновлений за день
- 1 июля 2025. Столбец склада в документах: Добавлено отображение поля склада между типом и датой с правильным разрешением названий складов вместо ID
- 1 июля 2025. Исправление редактирования документов: Решена проблема с незаполненным полем склада при открытии существующих документов
- 1 июля 2025. Система обновления документов: Создан PUT API endpoint для обновления документов, логика изменена для обновления существующих документов вместо создания новых
- 1 июля 2025. Исправление расчета остатков: Скорректированы SQL запросы в методе getInventory для правильной обработки десятичных полей количества
- 1 июля 2025. Изменение типов документов: Добавлена поддержка изменения типов документов (Оприходование ↔ Списание) с правильным пересчетом остатков
- 1 июля 2025. Улучшенная система именования документов: Изменен формат с "Type+ID" на "Type день.месяц-номер" (например "Оприходование 01.07-1")
- 1 июля 2025. Оптимизация интерфейса документов: Объединены выбор типа документа и склада в единый блок карты для более компактного пользовательского интерфейса
- 1 июля 2025. Модуль заказов: Создан полный модуль заказов с схемой базы данных, API маршрутами и пользовательским интерфейсом
- 1 июля 2025. Реорганизация навигации: Создано выпадающее меню "Настройки" содержащее Поставщиков, Контрагентов и Склады
- 1 июля 2025. Исправление визуальной согласованности: Скорректированы ширины столбцов в модуле заказов для соответствия другим страницам DataTable
- 1 июля 2025. Система резервирования для заказов: Добавлен чекбокс "Резерв" в формы создания и редактирования заказов
- 1 июля 2025. Устранение ручного обновления: Удалена кнопка "Обновить" из интерфейса остатков, настроена агрессивная инвалидация кеша
- 1 июля 2025. Исправление расчета отрицательной доступности: Удален Math.max(0, ...) из расчета доступности остатков в API endpoint
- 1 июля 2025. Рефакторинг архитектуры сервисов: Создано разделение бизнес-логики от API маршрутов через введение слоя сервисов
- 1 июля 2025. Транзакционная архитектура: Реализован TransactionService с атомарными операциями для всех операций с остатками
- 1 июля 2025. Московский часовой пояс: Настроен московский часовой пояс (UTC+3) во всей системе через создание timeUtils.ts
- 1 июля 2025. Интеграция Zod валидации: Добавлены middleware валидации во все критические API маршруты для операций удаления
- 1 июля 2025. Материализованные представления: Созданы inventory_summary и inventory_availability с автоматическими триггерами для оптимизации
- 1 июля 2025. Упрощение материализованных представлений: Удалена панель администратора, представления работают полностью автоматически
- 1 июля 2025. Централизованная система логирования: Создан структурированный логгер с поддержкой уровней DEBUG, INFO, WARN, ERROR
- 1 июля 2025. Комплексная система unit-тестов: Реализованы тесты для всех критических компонентов системы
- 1 июля 2025. Исправление unit-тестов: Решены проблемы с импортами, мокированием и логикой обработки данных (улучшение с 61% до 78%)
- 1 июля 2025. Исправление проблемы со временем: Полностью переписаны timeUtils функции для корректной работы с московским временем
- 1 июля 2025. Идеальное тестирование: Достигнут результат 100% успешных тестов (улучшение с 93% до 100%)
- 1 июля 2025. Оптимизация производительности: Устранены проблемы производительности, ускорение запросов в 50+ раз
- 1 июля 2025. Поле статуса документов: Добавлено поле status в документы со значениями 'draft' и 'posted'
- 1 июля 2025. Отслеживание времени изменений: Добавлено поле updatedAt в базу данных для документов и заказов
- 1 июля 2025. Исправление удаления заказов: Реализовано каскадное удаление связанных данных (резервы, позиции заказа)
- 1 июля 2025. Исправление кеширования: Устранена проблема когда удаленные записи продолжали отображаться в интерфейсе
- 1 июля 2025. Настройка таблиц: Добавлено изменение ширины столбцов и скрытие/показ столбцов с сохранением в localStorage
- 1 июля 2025. Интеграционное тестирование: Создана автоматизированная система тестирования покрывающая весь жизненный цикл ERP операций
- 1 июля 2025. Оптимизация архитектуры: Устранены все 53 использования типа 'any', разбит routes.ts на модульные файлы
- 1 июля 2025. Исправление TypeScript ошибок: Решена проблема с универсальной типизацией DataTable компонента
- 1 июля 2025. Оптимизация React: Добавлены useMemo хуки для всех колонок и конфигураций Excel во всех страницах
- 1 июля 2025. Zod валидация API: Добавлена полная валидация схем в API маршрутах с русскоязычными сообщениями об ошибках
- 1 июля 2025. Защита от DoS атак: Интегрирована защита через express-rate-limit с глобальными и API лимитами
- 1 июля 2025. React Query Devtools: Добавлены инструменты разработчика для отладки кеширования и мутаций
- 1 июля 2025. Исправление интеграционного тестирования: Решена проблема с валидацией русских символов в Zod enum
- 1 июля 2025. Оптимизация базы данных: Удалены неиспользуемые столбцы, пересозданы материализованные представления
- 1 июля 2025. Завершение оптимизации: Полностью завершена оптимизация БД с синхронизацией схем Drizzle
- 1 июля 2025. Система тестирования с агрегатором: Создана enterprise-ready архитектура интеграционного тестирования
- 1 июля 2025. Исправление API-роутинга: Устранены критические ошибки возврата HTML вместо JSON из API endpoints
- 1 июля 2025. Множественное удаление: Завершено исправление всех операций множественного удаления для 6 модулей системы
- 1 июля 2025. Автоматическая синхронизация changelog: Создан API endpoint /api/changelog для автоматического парсинга записей из replit.md
- 1 июля 2025. Полный перевод системы: Переведен весь replit.md на русский язык и обновлен парсер для поддержки русских записей
- 1 июля 2025. Исправление прыгающих записей: Устранена проблема случайного времени в парсере changelog, время теперь фиксированное на основе позиции записи
- 1 июля 2025. Уникальное время записей: Исправлен алгоритм генерации времени для создания уникальных временных меток каждой записи

## Пользовательские предпочтения

Preferred communication style: Simple, everyday language.
Always update Dashboard changelog: Add new entries to the changelog history on the Dashboard page for every system change or update.
When asked to create "identical" or "same" pages: Copy the exact structure, styling, and layout without adding extra wrappers or modifications. Pay attention to padding, margins, and HTML structure to ensure visual consistency.