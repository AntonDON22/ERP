Техническое задание для Replit
Тема: Полная миграция всех ручных схем валидации на централизованные поля из zFields.ts

⸻

Цель:
Устранить дублирование схем и ручную валидацию, заменив её на централизованные и повторно используемые поля. Это обеспечит архитектурную согласованность, улучшит читаемость, ускорит разработку и предотвратит повторные ошибки в валидации данных.

⸻

Задачи:

1. shared/schema.ts → Замена и создание централизованных схем

1.1. createOrderSchema.name
Строки 275–280
Текущая ручная валидация: z.string().min().max().trim().optional()
→ Заменить на zName.optional() из zFields.ts

1.2. createOrderSchema.notes
Строки 288–291
→ Создать в zFields.ts схему zNotes, которая валидирует до 1000 символов, очищает пробелы, и допускает undefined
→ Использовать zNotes в createOrderSchema

1.3. createOrderSchema.date
Строки 293–295
→ Создать схему zDate в zFields.ts, которая валидирует строку на соответствие формату даты через Date.parse
→ Использовать zDate в createOrderSchema

1.4. insertOrderSchema.name
Строки 302–305
→ Заменить ручную строку на zName из zFields.ts

1.5. orderSchema.status
Строка 339
→ Создать схему zOrderStatus в zFields.ts, используя z.enum([…])
→ Вынести возможные значения enum, например: “новый”, “в работе”, “завершен”, “отменен”
→ Использовать zOrderStatus в orderSchema

⸻

2. server/middleware/validation.ts → Унификация ID-схем

2.1. idParamSchema
Строки 92–97
→ Заменить валидацию на z.object({ id: zId }), где zId — это z.coerce.number().int().positive()
→ Если zId ещё не создан — добавить в zFields.ts с русским сообщением об ошибке

2.2. Массивы ID:
– productIdsSchema (103–109)
– supplierIdsSchema (111–117)
– contractorIdsSchema (119–125)
– documentIdsSchema (127–133)
– orderIdsSchema (135–141)
– warehouseIdsSchema (143–149)

→ Все используют одну и ту же ручную валидацию через z.array(z.number().positive().int())
→ Заменить на z.array(zId)
→ По желанию создать алиасы: zProductIdArray, zSupplierIdArray и т.д., если требуется контекстное разделение

⸻

3. Документация

Обновить SCHEMA_GUIDE.md или README в папке shared:

– Добавить описание всех новых схем:
– zName — название заказов, документов, товаров
– zNotes — примечания до 1000 символов
– zDate — строка-дата с проверкой
– zOrderStatus — enum для статуса заказа
– zId, zIdArray — универсальные ID

– Указать, что любые ручные .string() и .number() запрещены для типовых сущностей

⸻

Ожидаемый результат:

– Все 12 схем переведены на поля из zFields.ts
– Новые схемы добавлены только в одном месте, повторно используются везде
– Код стал чище, структура логичнее
– В будущем ошибки типов не повторяются
– Тесты проходят успешно, валидация централизована