# Middleware Tests

Тесты для middleware компонентов и безопасности системы.

## Файлы тестов

### validation.test.ts
Тестирует валидацию запросов и безопасность:
- **Zod схемы валидации**
- **Предотвращение XSS атак**
- **Защита от prototype pollution**
- **Русские сообщения об ошибках**
- **Обработка unicode данных**

**Покрытие**: 100% критических уязвимостей

## Критические проверки безопасности

### XSS Protection
```javascript
// Блокирует вредоносные скрипты
"<script>alert('hack')</script>" → Валидационная ошибка
"javascript:void(0)" → Валидационная ошибка
```

### Prototype Pollution Prevention
```javascript
// Защита от изменения прототипов
{"__proto__": {"isAdmin": true}} → Валидационная ошибка
{"constructor": {"prototype": {}}} → Валидационная ошибка
```

### SQL Injection Protection  
```javascript
// Блокирует SQL инъекции
"'; DROP TABLE users; --" → Валидационная ошибка
"1 OR 1=1" → Валидационная ошибка
```

### Unicode Validation
```javascript
// Корректная обработка русских символов
"Товар №1" → ✅ Валидно
"Склад «Основной»" → ✅ Валидно
```

## Тестируемые middleware

### Request Validation
- **Структура body** запросов
- **Типы данных** полей
- **Обязательные параметры**
- **Ограничения длины** строк

### Error Handling
- **Форматирование ошибок**
- **Русские сообщения**
- **HTTP статусы**
- **Логирование попыток атак**

### Rate Limiting
- **Ограничение запросов**
- **API endpoints защита**
- **DoS предотвращение**

## Запуск тестов

```bash
# Все middleware тесты
npx vitest run tests/middleware/

# Конкретный файл
npx vitest run tests/middleware/validation.test.ts

# С детальным выводом
npx vitest run tests/middleware/ --reporter=verbose
```

## Структура тестов безопасности

### Позитивные тесты
- Валидные данные проходят проверку
- Корректные типы принимаются
- Русские символы обрабатываются

### Негативные тесты
- Вредоносные данные блокируются
- Некорректные типы отклоняются
- Атаки предотвращаются

### Граничные тесты
- Максимальные длины строк
- Крайние числовые значения
- Специальные символы

## Важность для безопасности

Middleware тесты защищают от:
- **Инъекций кода** (XSS, SQL)
- **Изменения прототипов** (Prototype Pollution)
- **DoS атак** (Rate Limiting)
- **Некорректных данных** (Validation)

Критически важно поддерживать **100% покрытие** этих тестов.